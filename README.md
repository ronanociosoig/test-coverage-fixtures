# test-coverage-fixtures
Example projects in Swift for iOS (using Tuist) to show how to generate test coverage and compare the outputs using a range of different tools

## Introduction
The repository contains 4 simple sub-projects that are a demonstrator for generating test code coverage data using 4 different methods 

- 1: SonarQube script (shell script)
- 2: XCResultParser (Swift)
- 3: Xcode Coverage Generator (Swift)
- 4: Slather (Ruby)

The first 3 are all based on xccov (Xcode tools) extracting data from an xcresult bundle, and the output is identical. Although I expected the compiled code with Swift to be faster than a shell script, there was no noticeable difference in a large project with over 200k LOC. 

Slather is based on llvm-cov and extracts coverage data from a Coverage.profdata binary file. 

Slather uses the XcodeProj project file to find the path for derived data. In Tuist generated projects this doesn't work, so here I have used a .slather.yml file instead. To determine the correct folder a script checks the default derived data folder and finds the latest updated folder with the name of the project, and extracts out the identifier and updates the .slather.yml in the project. Then it runs the slather command to generate the XML file in the output folder. 

Note that Slather has a property for sources that functions as a filter for the coverage data. A point to note is that it doesn't use the code - only the file name is used as a filter. 

An advantage that Slather has over the other options is that files can be excluded by name. This improves the overall coverage accuracy for this case as I don't care about the source files generated by Tuist. 


## Scripts
This repo uses the following tools: 
- Tuist.io to generate the Xcode project and workspace. 

It uses the following parsing tools: 
- xcresultparser
- Xcodecoverageconverter
- Slather

### 1: Setup.sh 
This installs all the tools. 

### 2: runAllTests.sh
This script calls the 4 run scripts that first clear any test output, and then calls tuist test. 

It requires Xcode 15, the iPhone 15, and iOS 17.0 to run. You may have to adjust it for the Xcode and iOS versions you have available. 

The test command will generate an xcresult bundle in each project in the output folder. 

### 3: generate_slather_files.sh
This script uses the slather templates and searches the default Xcode derived data folder (~/Library/Developer/Xcode/DerivedData) to find the path for the Coverage.profdata. 

### 4: parseAllData.sh
This script runs all 4 parsing commands on all 4 projects and places everything in their respective output folders. 

## Additional Scripts
xccov_to_sonarqube_generic.sh is the script copied from SonarQube on Github. 

XCResultParser supports more formats than just SonarQube XML and scripts are here with their parameters to try out. 

 


